<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuddyBot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        <div class="bot-info">
            <div class="bot-avatar">ðŸ¤–</div>
            <div>
                <h2>BuddyBot</h2>
                <span class="status">Online</span>
            </div>
        </div>
        <button onclick="clearChat()" class="clear-btn">Clear</button>
    </div>

    <div id="chat-box" class="chat-box">
        <div class='bot-message'>Hey! I'm BuddyBot ðŸ‘‹ Type "help" to see what I can do!</div>
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
function sendMessage() {
    let input = document.getElementById("user-input");
    let message = input.value.trim();
    
    if (message === "") return;
    
    let chatBox = document.getElementById("chat-box");
    chatBox.innerHTML += `<div class='user-message'>${escapeHtml(message)}</div>`;
    
    // Show typing indicator
    chatBox.innerHTML += `<div class='bot-message typing' id='typing'>Typing...</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
    
    fetch("/get", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: "message=" + encodeURIComponent(message)
    })
    .then(response => response.json())
    .then(data => {
        // Remove typing indicator
        document.getElementById('typing').remove();
        
        chatBox.innerHTML += `<div class='bot-message'>${escapeHtml(data.reply)}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
    })
    .catch(error => {
        document.getElementById('typing').remove();
        chatBox.innerHTML += `<div class='bot-message'>Oops! Something went wrong.</div>`;
    });
    
    input.value = "";
}

function handleKeyPress(event) {
    if (event.key === "Enter") {
        sendMessage();
    }
}

function clearChat() {
    let chatBox = document.getElementById("chat-box");
    chatBox.innerHTML = `<div class='bot-message'>Chat cleared! How can I help you? ðŸ˜Š</div>`;
}

function escapeHtml(text) {
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
}
</script>

</body>
</html>